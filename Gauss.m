function S = Gauss(l,s1,t)
mu=3.986004418e14;

%坐标关系
U=l(:,2)./l(:,1);
S=s1(:,2)-U.*s1(:,1);
V=l(:,3)./l(:,1);
T=s1(:,3)-V.*s1(:,1);
%时间差
t2=[sqrt(mu)*(t(1)-t(2)),sqrt(mu)*(t(3)-t(2))];

%一步迭代取F,G前两项
r2=1e+7*[1,1,0];
f1=1-t2.^2/2/norm(r2)^3;
g1=t2-t2.^3/6/norm(r2)^3;
c1=g1(2)/(f1(1)*g1(2)-f1(2)*g1(1));
c3=-g1(1)/(f1(1)*g1(2)-f1(2)*g1(1));
%求解方程组2-192得到r1，r3
x0=[c1*(U(1)-U(2)),c3*(U(3)-U(2));c1*(V(1)-V(2)),c3*(V(3)-V(2))]\[S(2)-c1*S(1)-c3*S(3);T(2)-c1*T(1)-c3*T(3)];
y1=U(1)*x0(1)+S(1);
z1=V(1)*x0(1)+T(1);
y3=U(3)*x0(2)+S(3);
z3=V(3)*x0(2)+T(3);
r1=[x0(1);y1;z1];
r3=[x0(2);y3;z3];
%计算速度
% A=[-U(1)*g1(1),g1(1),0; ...
%    -V(1)*g1(1),0,g1(1);...
%    -U(2)*g1(2),g1(2),0; ...
%    -V(2)*g1(2),0,g1(2);];
% B=[S(1)-f1(1)*S(2)-f1(1)*(U(2)-U(1))*r2(2);...
%    T(1)-f1(1)*T(2)-f1(1)*(V(2)-V(1))*r2(2);...
%    S(2)-f1(2)*S(2)-f1(2)*(U(2)-U(2))*r2(2);...
%    T(2)-f1(2)*T(2)-f1(2)*(V(2)-V(2))*r2(2);];
% v2=A\B;
v2=(r3-r1)/(t(3)-t(1));

%更新r2
r2=c1*r1+c3*r3;
pre_r1=r1;
pre_r3=r3;

i=1;
%主循环取F,G前三项
while 1
f=1-t2.^2/2/norm(r2)^3+t2.^3/2/norm(r2)^4*norm(v2);
g=t2-t2.^3/6/norm(r2)^3+t2.^4/4/norm(r2)^4*norm(v2);    
c1=g(2)/(f(1)*g(2)-f(2)*g(1));
c3=-g(1)/(f(1)*g(2)-f(2)*g(1));
%求解方程组2-192得到r1，r3
x0=[c1*(U(1)-U(2)),c3*(U(3)-U(2));c1*(V(1)-V(2)),c3*(V(3)-V(2))]\[S(2)-c1*S(1)-c3*S(3);T(2)-c1*T(1)-c3*T(3)];
y1=U(1)*x0(1)+S(1);
z1=V(1)*x0(1)+T(1);
y3=U(3)*x0(2)+S(3);
z3=V(3)*x0(2)+T(3);

r1=[x0(1);y1;z1];
r3=[x0(2);y3;z3];

r2=c1*r1+c3*r3;
A=[-U(1)*g(1),g(1),0; ...
   -V(1)*g(1),0,g(1);...
   -U(2)*g(2),g(2),0; ...
   -V(2)*g(2),0,g(2);];
B=[S(1)-f(1)*S(2)-f(1)*(U(2)-U(1))*r2(2);...
   T(1)-f(1)*T(2)-f(1)*(V(2)-V(1))*r2(2);...
   S(2)-f(2)*S(2)-f(2)*(U(2)-U(2))*r2(2);...
   T(2)-f(2)*T(2)-f(2)*(V(2)-V(2))*r2(2);];
v2=A\B;
%v2=(r3-r1)/(t(3)-t(1));



%迭代终止条件
if(norm(r1-pre_r1)<1e-20&&norm(r3-pre_r3)<1e-20) 
    R21=r1;
    R22=r2;
    R23=r3;
    v2=(r3-r1)/(t(3)-t(1));
    S=[r2',v2'];
    break
else
      pre_r1=r1;
      pre_r3=r3;
      i=i+1;
end
end


end

